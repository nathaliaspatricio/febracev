{% extends "blog/base_blog.html" %}


{% block title %}{{ object.title }}{% endblock %}
{% block body_class %}{{ block.super }} post_detail{% endblock %}
{% block body_id %}post_{{ object.id }}{% endblock %}


{% block content_title %}

{% endblock %}


{% block content %}
  {% load blog markup comments tagging_tags %}
    <h1>Diário de Bordo do projeto {{project.name}}</h1>
    <br>
    <p class="other_posts">
    {% if object.get_previous_by_publish %}
        <a class="previous" href="{{ object.get_previous_post.get_absolute_url }}">&laquo; {{ object.get_previous_post }}</a>
    {% endif %}
    {% if object.get_next_by_publish %}
        | <a class="next" href="{{ object.get_next_post.get_absolute_url }}">{{ object.get_next_post }} &raquo;</a> 
    {% endif %}  
    {% if is_owner %}
        <br/>
        {% if project.slug %}
            <a href={% url blog_edit_post_slug project_slug=project.slug year=object.publish.year month=month day=object.publish.day slug=object.slug %}>editar</a>
        {% else %}
            <a href={% url blog_edit_post edition=project.edition category=project.category code=project.code year=object.publish.year month=month day=object.publish.day slug=object.slug %}>editar</a>
        {% endif %}
    {% endif %}
    </p>
    <br>
    <h2>{{ object.title }}</h2>
    <p class="date">{{ object.publish|date:"j F Y" }}</p>
    <br>
    <div class="body">
        {{ object.body|markdown:"safe" }}
    </div>
    <br>
    {% tags_for_object object as tag_list %}
    {% if tag_list %}
        <p class="inline_tag_list"><strong>Tags:</strong>
        {% for tag in tag_list %}
            {{ tag }}{% if not forloop.last %}, {% endif %}
        {% endfor %}
        </p>
    {% endif %}
    <br>

  {% get_comment_list for object as comment_list %}
  {% if comment_list %}
  <div id="comments">
{% load comments %}


    <a name="comments"></a>
    <h3 class="comments_title">Comments</h3>
    {% for comment in comment_list %}
      {% if comment.is_public %}
      <div class="comment">
        <h5 class="name">
          <a name="c{{ comment.id }}" href="{{ comment.get_absolute_url }}" title="Permalink to {{ comment.person_name }}'s comment" class="count">{{ forloop.counter }}</a> 
          {% if comment.user_url %}<a href="{{ comment.user_url }}">{{ comment.user_name }}</a>{% else %}{{ comment.user_name }}{% endif %} says...
        </h5>
        {{ comment.comment|urlizetrunc:"60"|markdown:"safe" }}
        <p class="date">Posted at {{ comment.submit_date|date:"P" }} on {{ comment.submit_date|date:"F j, Y" }}</p>
      </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
  {% if object.allow_comments %}
    {% get_comment_form for object as form %}
    <form action="{% comment_form_target %}" method="POST">
        {% if user.is_anonymous %}
            <p><label for="id_name">Nome</label>{{ form.name }}</p>
            <p><label for="id_email">Email</label>{{ form.email }}</p>
        {% endif %}
        <p><label for="id_comment">Recado</label>{{ form.comment }}</p>
         <p style="display:none;">
             <label for="id_honeypot">Se você escrever algo aqui,
                 seu recado será tratado como spam</label>
            {{ form.honeypot }}
        </p>
        {{ form.content_type }}
        {{ form.object_pk }}
        {{ form.timestamp }}
        {{ form.security_hash }}
        <input type="hidden" name="next" value="{{ object.get_absolute_url }}" />
        <input type="submit" value="Enviar recado" id="id_submit" />
    </form>
  {% else %}
    <div id="comment_form">
      <h3>Caixa de comentários fechada.</h3>
      <p>Esse post não permite comentários.</p>
    </div>
  {% endif %}
{% endblock %}
